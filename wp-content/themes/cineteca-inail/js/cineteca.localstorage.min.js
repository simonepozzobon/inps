function cineteca_inail_check_local_storage(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}function cineteca_inail_addFilmToRassegna(a,b){if(cineteca_inail_check_local_storage())try{var c=[];if(null!=window.localStorage.getItem(b+ls_id)&&(c=cineteca_inail_getFilmInRassegna(b)),c.indexOf(a)<=-1){if(c.length>=10)return void cineteca_inail_film_limit();c.push(a),cineteca_inail_film_added()}else cineteca_inail_film_already_added();window.localStorage.setItem(b+ls_id,JSON.stringify(c))}catch(d){return!1}else if(null==cineteca_inail_getCookie(b+ls_id))cineteca_inail_createCookie(b+ls_id,a,3600,"/"),cineteca_inail_film_added();else{var e=cineteca_inail_getCookie(b+ls_id);if(10==e.length)return cineteca_inail_film_limit(),!1;e.push(a),e=e.filter(cineteca_inail_only_unique),cineteca_inail_deleteCookie(b+ls_id),cineteca_inail_createCookie(b+ls_id,e,3600,"/"),cineteca_inail_film_added()}cineteca_inail_update_viewed_numbers(b)}function cineteca_inail_getFilmInRassegna(a){var b=[];if(cineteca_inail_check_local_storage())try{return JSON.parse(window.localStorage.getItem(a+ls_id))}catch(c){return null}else var b=cineteca_inail_getCookie(a+ls_id);return b}function cineteca_inail_removeFilmFromRassegna(a,b){var c=document.getElementById("bb-q-result-"+a);if(c.parentElement.removeChild(c),cineteca_inail_check_local_storage()){var d=cineteca_inail_getFilmInRassegna(b);d=d.filter(function(b){return b!=a}),localStorage.setItem(b+ls_id,JSON.stringify(d))}else{var e=cineteca_inail_getCookie(b+ls_id),f=[];if(1==e.length)cineteca_inail_deleteCookie(b+ls_id,"/");else{for(var g=0;g<e.length;g++)e[g]!=a&&f.push(e[g]);cineteca_inail_deleteCookie(b+ls_id,"/"),cineteca_inail_createCookie(b+ls_id,f.join(","),3600,"/")}}return cineteca_inail_update_viewed_numbers(b),!0}function cineteca_inail_get_storage_count(a){if(cineteca_inail_check_local_storage()){var b=cineteca_inail_getFilmInRassegna(a);return null==b?0:b.length}var c=cineteca_inail_getCookie(a+ls_id);return null==c?0:c.length}function cineteca_inail_update_viewed_numbers(a){var b=cineteca_inail_get_storage_count(a);document.getElementById("bb-num-film-added").innerHTML=b,document.getElementById("bb-num-film-remain").innerHTML=10-b}function cineteca_inail_getCookie(a){for(pCOOKIES=new Array,pCOOKIES=document.cookie.split("; "),bb=0;bb<pCOOKIES.length;bb++)if(NmeVal=new Array,NmeVal=pCOOKIES[bb].split("="),NmeVal[0]==a){var b=decodeURI(NmeVal[1]),c=b.split(",");return c}return null}function cineteca_inail_deleteCookie(a,b,c){cineteca_inail_getCookie(a)&&cineteca_inail_createCookie(a,"",-2,b,c)}function cineteca_inail_createCookie(a,b,c,d,e){var f=a+"="+b+";";c&&(c instanceof Date?isNaN(c.getTime())&&(c=new Date):c=new Date((new Date).getTime()+1e3*parseInt(c)*60*60*24),f+="expires="+c.toGMTString()+";"),d&&(f+="path="+d+";"),e&&(f+="domain="+e+";"),document.cookie=f}function cineteca_inail_transfer_rassegna(a){var b=[],c=[],d=[];if(c=cineteca_inail_getFilmInRassegna(0),0!=c.length){if(b=c,d=cineteca_inail_getFilmInRassegna(a),0!=d.length&&(b=d.concat(c).unique().slice(0,10)),cineteca_inail_check_local_storage())try{window.localStorage.removeItem("0"+ls_id),window.localStorage.setItem(a+ls_id,JSON.stringify(b))}catch(e){return!1}else cineteca_inail_deleteCookie(a+ls_id),cineteca_inail_createCookie(a+ls_id,b,3600,"/");cineteca_inail_update_viewed_numbers(a),cineteca_inail_rassegna_transferred()}}function cineteca_inail_only_unique(a,b,c){return c.indexOf(a)===b}function cineteca_inail_film_limit(){alert("Hai raggiunto il limite di film. Non puoi inserirne pi\xf9 di 10 nella rassegna")}function cineteca_inail_film_added(){alert("Il film selezionato \xe8 stato aggiunto alla tua rassegna")}function cineteca_inail_film_already_added(){alert("Il film selezionato \xe8 gi\xe0 presente nella tua rassegna")}function cineteca_inail_rassegna_transferred(){alert("La rassegna creata precedentemente \xe8 stata trasferita sul tuo account")}var ls_id="_cineteca_inail_rassegna";cineteca_inail_update_viewed_numbers(bb_ajax_handler.userid),Array.prototype.unique=function(){for(var a=this.concat(),b=0;b<a.length;++b)for(var c=b+1;c<a.length;++c)a[b]===a[c]&&a.splice(c--,1);return a};